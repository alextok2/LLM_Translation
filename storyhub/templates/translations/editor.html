{% extends "base.html" %}
{% block title %}Редактор: {{ story.title }}{% endblock %}

{% block content %}
<div class="mx-auto max-w-6xl px-4">
  <header class="mb-6">
    <h1 class="text-2xl font-bold">{{ story.title }}</h1>
    <p class="text-gray-600 mt-1">{{ story.description }}</p>

    <div class="mt-4">
      <div class="flex items-center justify-between text-sm text-gray-600 mb-2">
        <span>Прогресс: {{ story.translated_count }}/{{ story.paragraphs_count }}</span>
        <span class="font-medium">{{ progress_percent }}%</span>
      </div>
      <div class="h-2 w-full bg-gray-200 rounded-full overflow-hidden">
        <div class="h-2 bg-purple-600" style="width: {{ progress_percent }}%"></div>
      </div>
    </div>
  </header>

  {% if chapters %}
    {% for ch in chapters %}
      <h2 class="text-lg font-semibold mt-10 mb-4 border-b pb-2">
        Глава {{ ch.index }}{% if ch.title %}: {{ ch.title }}{% endif %}
      </h2>
      <div class="space-y-5">
        {% for p in ch.paragraphs.all %}
          {% include "translations/_paragraph_row.html" with p=p %}
        {% endfor %}
      </div>
    {% endfor %}
  {% else %}
    <div class="space-y-5">
      {% for p in paragraphs %}
        {% include "translations/_paragraph_row.html" with p=p %}
      {% endfor %}
    </div>
  {% endif %}

  {% if story.translated_count == story.paragraphs_count and story.paragraphs_count > 0 %}
    <form hx-post="/api/stories/{{ story.id }}/complete/" hx-swap="none" class="mt-8">
      {% csrf_token %}
      <button class="bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700">
        Отметить историю как готовую
      </button>
    </form>
  {% endif %}
</div>
{% endblock %}